

# 项目：教室租借系统

| 客户端              | 服务端              | 数据持久化          | 网络                | 评估                | 架构                |
| ------------------- | ------------------- | ------------------- | ------------------- | ------------------- | ------------------- |
| **丁玟月** 71117401 | **张婧媛** 71117402 | **刘钰宵** 71117405 | **张景天** 71117435 | **梅洛瑜** 71117408 | **卢立强** 71117417 |

<small>^*^具体分工在文档末尾</small>

*   项目地址: https://github.com/HanyuuFurude/LeaderMeiSaveTheWorld

*   介绍页链接:https://github.com/HanyuuFurude/LeaderMeiSaveTheWorld

    ![1555606183424](AllIn/QRCode.png)

[TOC]

# 需求分析

## 项目名称：教室预约系统

## 引言

本文档是教室预约系统的需求分析文档，

### 编写目的

受甲方xxx委托，为甲方单位开发教室预约系统一套。用于师生快速预约教室之用。

### 项目风险

*   系统不能按期交付
*   系统不能按预期运行
*   系统可能会导致甲方数据库故障

### 产品范围

*   教室预约客户端程序一套
*   教室预约服务端程序一套
*   说明文档一套
    *   需求分析文档一份
    *   架构设计文档一份
    *   详细设计文档一份
    *   其他附加文档

### 文档约定

| 缩略语   | 英文全名                      | 中文解释       | 备注                                   |
| -------- | ----------------------------- | -------------- | -------------------------------------- |
| uuid     | Universally Unique Identifier | 通用唯一识别码 | 不可更改（数据库里标识主键的标识码）   |
| id       | Identifier                    | 用户id         | 用于登录（登录框的用户名）             |
| identify | Identify                      | 用户类型       | 表示用户类型（在客户端上显示的用户名） |
| name     | Name                          | 用户名         | 昵称                                   |
| passwd   | Password                      | 用户密码       | 哈希值（32-bit md5）                   |
| sess     | Session                       | 用户会话id     | 全局唯一                               |

## 综合描述

### 产品状况

该系统依托于甲方学校现有师生信息数据库，增加教室预约功能，是甲方师生信息系统中的一个全新的模块。

### 产品功能

该系统为师生提供一个教室预约信息查询、预约的应用程序。

用户使用自己在甲方学校已有的账户进行登录。提供查询并选择空余教室并预约的功能。

*   登录功能

    *   使用者：甲方学校师生
    *   描述： 使用者使用自己在该学校的账号密码作为身份标识在客户端上进行登录的功能

*   登出功能

    *   使用者：甲方学校师生
    *   描述： 使用者撤销自己在客户端上的登陆标识的功能

*   查询功能

    *   使用者：甲方学校师生

    *   描述：使用者在客户端上查询可预约教室的功能^*^

        <small>^*^若在进行此功能前用户已完成登陆功能、此功能会指示使用者预约的教室</small>

*   预约功能

    *   使用者：甲方学校师生
    *   描述：使用者在登陆后，在客户端上预约可用时间段内未被预约的教室的功能

### 运行环境

#### 硬件平台

*   服务端：刀片式架构服务器一台
*   客户端：x86-64 x86 arm架构的计算设备

#### 操作系统和版本

*   服务器：Windows 10 x64 with java 8
*   客户端：能运行java 8 jre的操作系统环境

#### 支撑环境

*   MySQL 8.0.15

### 设计和实现限制

*   技术栈
    *   Java 8
    *   MySQL 8
    *   Windows 10 x64
*   编码规范
    *   阿里Java开发手册1.3.0
*   硬件限制
    *   500GB储存空间
    *   20GB内存空间
    *   100Mbps上下行带宽

### 假设和约束

*   数据库
    *   账户数据库为甲方学校提供的数据库
*   用户
    *   所有用户的账户都储存于甲方学校数据库中，且不需要注册和销户功能
*   工期约束
    *   28个自然日
*   设备约束
    *   500GB储存空间
    *   20GB内存空间
    *   100Mbps上下行带宽

## 外部接口需求

### 用户界面

### 硬件接口

*   使用平台ui默认风格
*   使用标准ui库
*   ux系统包含如下三个ux组件
    *   登录ux系统
    *   查询ux系统（主系统）
    *   预约ux系统
*   通讯协议
    *   socket

### 软件接口

*   操作系统
    *   windows 10 x64
*   数据库
    *   MySQL
*   工具
    *   开发工具
        *   Java 8
        *   Maven 2.8
        *   JetBrains Intellij IDEA 201901
        *   Visual Code 1.33
        *   Eclipse 4.5
        *   Typora 0.9
        *   MySQL Community 8
        *   MySQL WorkBench 8
    *   部署工具
        *   7z
    *   运维工具
        *   RDP
*   函数库
    *   Java stand library
    *   Netty
    *   Swing

### 通讯接口

*   Java sockect
*   传输格式
    *   object（详细消息格式见附录）
    *   密码通过md5计算后通过参与通讯

## 系统功能需求

### 说明和优先级

| 优先级 | 功能 | 描述                                                         |
| ------ | ---- | ------------------------------------------------------------ |
| 9      | 登陆 | 使用者使用自己在该学校的账号密码作为身份标识在客户端上进行登录的功能 |
| 3      | 登出 | 使用者撤销自己在客户端上的登陆标识的功能                     |
| 8      | 查询 | 使用者在客户端上查询可预约教室的功能                         |
| 9      | 预约 | 使用者在登陆后，在客户端上预约可用时间段内未被预约的教室的功能 |



### 激励/响应序列

![login](E:/Repos/LeaderMeiSaveTheWorld/doc/pic/login.jpg)

![logout](E:/Repos/LeaderMeiSaveTheWorld/doc/pic/logout.jpg)

![query](E:/Repos/LeaderMeiSaveTheWorld/doc/pic/query.jpg)

![update](E:/Repos/LeaderMeiSaveTheWorld/doc/pic/update.jpg)

#### 数据结构

本系统与客户方已有的用户数据库对接，对方数据库使用MySQL，表结构如下：

*   用户信息表
*   User Info Tabel

| uuid(master key) | id       | identity    | name    | password(hash) |
| ---------------- | -------- | ----------- | ------- | -------------- |
| CHAR[64]         | BYTE[64] | VARCHAR[64] | VARCHAR | CHAR[32]       |

*   日志记录表（两份，一份记录当日往前7日（含当日）的日志，另一份存历史日志）
*   Log Tabel

| classRoom(master key) | uuid     | startTIme | endTime | used | breach | remarks  |
| --------------------- | -------- | --------- | ------- | ---- | ------ | -------- |
| CHAR[64]              | CHAR[64] | DATE      | DATE    | bool | bool   | CHAR[64] |

## 其他非功能需求

### 性能需求

*   平均宕机时间不超过99.9%
*   承受并发量500以下的负载
*   工作时间7*18h（6小时下线时间、可用于备份、维护、整理、故障恢复和磁盘优化）
*   预约时间
*   用户操作到反馈的时间不高于7s

### 安全措施需求

*   需要数据持久化方面的支持、，保存最近90日内写操作记录
*   不允许明文保存密码
*   有防止SQL注入攻击、DDOS的能力
*   有完善的日志系统

### 软件质量属性

*   要求所有参数均可以通过配置文件修改
*   允许数据迁移

# 架构设计

## 项目名称：教室预约系统

## 引言

本文档是教师预约系统的需求分析文档，

### 编写目的

受甲方xxx委托，为甲方单位开发教室预约系统一套。用于师生快速预约教室之用。

### 项目风险

*   系统不能按期交付
*   系统不能按预期运行
*   系统可能会导致甲方数据库故障

## 设计概述

### 限制和约束

*   技术栈
    *   Java 8
    *   MySQL 8
    *   Windows 10 x64
*   编码规范
    *   阿里Java开发手册1.3.0
*   硬件限制
    *   500GB储存空间
    *   20GB内存空间
    *   100Mbps上下行带宽
    *   数据库
        *   账户数据库为甲方学校提供的数据库
    *   用户
        *   所有用户的账户都储存于甲方学校数据库中，且不需要注册和销户功能
    *   工期约束
        *   28个自然日
    *   设备约束
        *   500GB储存空间
        *   20GB内存空间
        *   100Mbps上下行带宽

### 设计原则和要求

*   商业原则
    *   高性价比
    *   受控的信息管理
    *   事物持续性
    *   兼容其他软件和操作系统
    *   知识产权保护
    *   7x24运维支持
    *   符合相关法律
*   数据原则
    *   数据资产保护
    *   数据共享保护
    *   受控数据访问
    *   可靠数据托管
    *   容易理解的数据定义和词汇
    *   数据安全性保证
*   应用程序原则
    *   技术无关
    *   易用
*   技术原则
    *   容许一定限度内的需求变化
    *   快速响应变更管理
    *   互操作性强
    *   控制技术多样
*   遵循关注点分离原则
*   遵循单一职责原则
*   遵循LoD原则

## 系统逻辑设计

### 系统组织设计

| 子系统编号 | 名称       | 业务职能                                                     | 安装地点           | 备注 |
| ---------- | ---------- | ------------------------------------------------------------ | ------------------ | ---- |
| 1          | 客户端系统 | 与客户交互，负责向用户提供登陆、查询和预约操作界面           | 客户端、客户机     |      |
| 2          | 服务端系统 | 接收客户端的数据并进行合法性验证、对比数据库的数据完成用户发起的操作并下发结果 | 服务端、生产服务器 |      |
| 3          | 数据库系统 | 提供账户信息读取和订单信息读写                               | 服务端、数据服务器 |      |
| 4          | 日志系统   | 提供系统日志                                                 | 服务端、所有服务器 |      |

### 系统结构设计

![class](E:/Repos/LeaderMeiSaveTheWorld/doc/pic/class.jpg)

#### 系统特性表

*   子系统编号：1

*   子系统名称：客户端系统

*   特性

    *   特性编号：0
        *   操作功能：验证用户填写的用户名和密码符合形式正确
        *   调用对象： 事件系统和登录按钮
        *   被调用对象：登录ux系统
    *   特性编号：1
        *   操作功能：将用户名密码md5值通过网络发送
        *   调用对象： 事件系统和登录按钮
        *   被调用对象：登录ux系统、网络模块
    *   特性编号：2
        *   操作功能：向服务端查询教室占用情况并更新ui系统
        *   调用对象：事件系统
        *   被调用对象：登录ux系统、网络模块
    *   特性编号：3
        *   操作功能：向服务端发送订单信息
        *   调用对象：用户
        *   被调用对象：订单ux系统、网络模块

*   子系统编号：2

*   子系统名称：服务端系统

*   特性

    *   特性编号：1
        *   操作功能：验证登陆
        *   调用对象：网络监听触发事件
        *   被调用对象：登陆验证模块、数据库
    *   特性编号：2
        *   操作功能：订单处理
        *   调用对象：网络监听触发事件
        *   被调用对象：订单冲突检测模块、数据库
    *   特性编号：3
        *   操作功能：占用查询
        *   调用对象：网络监听触发事件
        *   被调用对象：订单冲突检测模块、订单写入模块、数据库

*   子系统编号：3

*   子系统名称：数据库

*   特性

    *   特性编号：1
        *   操作功能：账号信息查询
        *   调用对象：服务端
        *   被调用对象：数据库
    *   特性编号：2
        *   操作功能：订单查询
        *   调用对象：服务端
        *   被调用对象：数据库
    *   特性编号：3
        *   操作功能：订单增加
        *   调用对象：服务端
        *   被调用对象：数据库

*   子系统编号：4

*   子系统名称：日志系统

*   特性

    *   特性编号：1
        *   操作功能：日志记录
        *   调用对象：服务端、数据库
        *   被调用对象：日志系统

    

#### 系统特性结构图

![class](E:/Repos/LeaderMeiSaveTheWorld/doc/pic/class.jpg)

### 系统接口设计

#### 系统接口表

| 序号 | 名称        | 功能                       |
| ---- | ----------- | -------------------------- |
| 0    | login       | 客户端发起登录请i去        |
| 1    | logout      | 客户端执行登出操作         |
| 2    | update      | 客户端请求更新教室占用信息 |
| 3    | post        | 向服务器提交一个订单       |
| 4    | acceptLogin | 服务器接受登录             |
| 5    | get         | 服务器得到一个订单         |



## 系统出错处理设计

### 系统出错处理表

#### 状态码

*   0x0000
    *   操作成功（无异常）
*   0x0001
    *   网络失败（网络连接异常）[附录0000](#0000)
*   0x0002
    *   找不到服务器（网络连接正常但是服务器无法访问）[附录0000](#0000)
*   0x0003
    *   服务不可用（服务器能ping通但是网络接口不响应）
*   0x0004-0x000f
    *   预留
*   0x0010
    *   登陆失败：账号密码填写错误
*   0x0011
    *   登录超时：会话连接已超时
*   0x0012
    *   账号异常：账号信息异常，请重新登录[附录0003](#0003)
*   0x0013
    *   要求登录：请登录[附录0001](#0001)
*   0x0014
    *   权限不足：权限不足[附录0002](#0002)
*   0x0015
    *   操作失败：预约冲突，房间已经被预约
*   0x0016
    *   操作失败：预约失败，请求预约的信息不合法
*   0x0017
    *   操作失败，频繁登录
*   0x0018-0x001f
    *   预留
*   0x0020
    *   服务不可用：服务器正在维护，暂停提供预约服务
*   0x0021
    *   不在服务时间内：不在服务时间内，不提供预约服务

#### 附加说明

*   ###### 0000

关于返回```0x0001```和```0x0002```的区别：当发现连接错误时，请先尝试ping一下网址：

*   https://www.baidu.com
*   https://www.bing.com
*   https://www.google.com

ping设置，每个网址ping 4次，超时5000ms，如果至少有一次成功，应当返回```0x0002```，否则返回```0x0001```

*   ###### 0001

当前仅当用户为visitor并且尝试预约时，返回该状态码，此时服务端应该提示需要登陆并打开登陆界面

*   ###### 0002

发现提交的操作不符合账户权限，防止用户使用非正常操作方式（比如爬虫等）使用当前用户尝试操作当前等级不允许操作的操作，则返回此状态码

*   ###### 0003

发现会话信息和用户信息不匹配，防止用户使用非正常操作方式（比如爬虫等），构造不合法的身份信息



### 维护处理过程表

*   每日停止服务后，系统将自动执行当日的数据归档维护工作
*   待自动维护完成后，管理员可以对历史数据（日志文件）进行增量式备份
*   若要迁移数据，只需重新设置数据库位置即可运行，若需要迁移日志也可一并迁移
*   建议使用raid磁盘阵列储存数据库和日志以减轻硬盘故障带来的损害
*   建议使用windows的还原点功能进行备份

## 数据库设计

本系统与客户方已有的用户数据库对接，对方数据库使用MySQL，表结构如下：

*   用户信息表
*   User Info Tabel

| uuid(master key) | id       | identity    | name    | password(hash) |
| ---------------- | -------- | ----------- | ------- | -------------- |
| CHAR[64]         | BYTE[64] | VARCHAR[64] | VARCHAR | CHAR[32]       |

*   日志记录表（两份，一份记录当日往前7日（含当日）的日志，另一份存历史日志）
*   Log Table

| classRoom(master key) | uuid     | startTIme | endTime | used | breach | remarks  |
| --------------------- | -------- | --------- | ------- | ---- | ------ | -------- |
| CHAR[64]              | CHAR[64] | DATE      | DATE    | bool | bool   | CHAR[64] |

## 词汇表

| 缩略语   | 英文全名                      | 中文解释       | 备注                                   |
| -------- | ----------------------------- | -------------- | -------------------------------------- |
| uuid     | Universally Unique Identifier | 通用唯一识别码 | 不可更改（数据库里标识主键的标识码）   |
| id       | Identifier                    | 用户id         | 用于登录（登录框的用户名）             |
| identify | Identify                      | 用户类型       | 表示用户类型（在客户端上显示的用户名） |
| name     | Name                          | 用户名         | 昵称                                   |
| passwd   | Password                      | 用户密码       | 哈希值（32-bit md5）                   |
| sess     | Session                       | 用户会话id     | 全局唯一                               |

## 进度计划

*   week1
    *   项目分析、需求分析
*   week2
    *   架构分析、技术选型、原型开发
*   week3
    *   项目演进，文档演进
*   week4
    *   项目基本完成、文档演进、准备交付

# 详细设计

## 项目名称：教室预约系统

## 引言

本文档是教室预约系统的需求分析文档，

### 编写目的

受甲方xxx委托，为甲方单位开发教室预约系统一套。用于师生快速预约教室之用。

### 项目风险

*   系统不能按期交付
*   系统不能按预期运行
*   系统可能会导致甲方数据库故障

## 支撑环境

*   Windows 10 x86-64
*   本项目基于java构建，兼容java11，12（其他版本尚未测试）
*   本项目由maven进行包管理
*   本项目的版本控制由git管理，使用github作为远程git服务端。

### 数据库管理系统

*   MySQL 8

### 开发工具、中间件和数据库接口

*   开发工具
    *   Java 8
    *   Maven 2.8
    *   JetBrains Intellij IDEA 201901
    *   Visual Code 1.33
    *   Eclipse 4.5
    *   Typora 0.9
    *   MySQL Community 8
    *   MySQL WorkBench 8
*   中间件
    *   无
*   数据库接口
    *   MySQL ODBC

### 硬件环境

*   服务端：刀片式架构服务器一台
*   客户端：x86-64 x86 arm架构的计算设备

### 网络环境

100Mbps上下行带宽

## 部件详细设计

![usecase](E:/Repos/LeaderMeiSaveTheWorld/doc/pic/usecase.jpg)

![login](E:/Repos/LeaderMeiSaveTheWorld/doc/pic/login.jpg)

![logout](E:/Repos/LeaderMeiSaveTheWorld/doc/pic/logout.jpg)

![query](E:/Repos/LeaderMeiSaveTheWorld/doc/pic/query.jpg)

![update](E:/Repos/LeaderMeiSaveTheWorld/doc/pic/update.jpg)

![class](E:/Repos/LeaderMeiSaveTheWorld/doc/pic/class.jpg)

## 词汇表

| 缩略语   | 英文全名                      | 中文解释       | 备注                                   |
| -------- | ----------------------------- | -------------- | -------------------------------------- |
| uuid     | Universally Unique Identifier | 通用唯一识别码 | 不可更改（数据库里标识主键的标识码）   |
| id       | Identifier                    | 用户id         | 用于登录（登录框的用户名）             |
| identify | Identify                      | 用户类型       | 表示用户类型（在客户端上显示的用户名） |
| name     | Name                          | 用户名         | 昵称                                   |
| passwd   | Password                      | 用户密码       | 哈希值（32-bit md5）                   |
| sess     | Session                       | 用户会话id     | 全局唯一                               |

## 进度计划

*   week1
    *   项目分析、需求分析
*   week2
    *   架构分析、技术选型、原型开发
*   week3
    *   项目演进，文档演进
*   week4
    *   项目基本完成、文档演进、准备交付

# 软件总体设计说明书

## 关键词

教室租借、 c/s、MVC

## 摘要

该说明书描述了一个教室租用系统的架构，本架构致力于构建一个高可用性的、用户友好的、稳定的教室租用系统。

使用了c/s架构、MVC架构

使用UML作为指导语言



## 缩略语说明：

| 缩略语   | 英文全名                      | 中文解释       | 备注                                   |
| -------- | ----------------------------- | -------------- | -------------------------------------- |
| uuid     | Universally Unique Identifier | 通用唯一识别码 | 不可更改（数据库里标识主键的标识码）   |
| id       | Identifier                    | 用户id         | 用于登录（登录框的用户名）             |
| identify | Identify                      | 用户类型       | 表示用户类型（在客户端上显示的用户名） |
| name     | Name                          | 用户名         | 昵称                                   |
| passwd   | Password                      | 用户密码       | 哈希值（32-bit md5）                   |
| sess     | Session                       | 用户会话id     | 全局唯一                               |

## 参考资料

*   [项目地址](https://github.com/HanyuuFurude/LeaderMeiSaveTheWorld)

## 引言

### 目的

该说明书描述了一个教室租用系统的架构、满足客户要求的的各项需求（包括但不限于：实时性需求、用户量、并发量需求、灾备、安全需求、可重用性、质量属性）面向所有利益相关者、撰写此文档。

### 范围

本文包括系统概述、用户需求概述等，简述了该系统的总体构成和工作流程、性能指标和其他需求。

## 总体概述

### 指标描述

*   平均宕机时间不超过99.9%
*   承受并发量500以下的负载
*   工作时间7*18h（6小时下线时间、可用于备份、维护、整理、故障恢复和磁盘优化）
*   预约时间
*   用户操作到反馈的时间不高于7s

### 本系统上下文说明

#### 软件结构

本系统与客户方已有的用户数据库对接，对方数据库使用MySQL，表结构如下：

*   用户信息表
*   User Info Tabel

| uuid(master key) | id       | identity    | name    | password(hash) |
| ---------------- | -------- | ----------- | ------- | -------------- |
| CHAR[64]         | BYTE[64] | VARCHAR[64] | VARCHAR | CHAR[32]       |

*   日志记录表（两份，一份记录当日往前7日（含当日）的日志，另一份存历史日志）
*   Log Table

| classRoom(master key) | uuid     | startTIme | endTime | used | breach | remarks  |
| --------------------- | -------- | --------- | ------- | ---- | ------ | -------- |
| CHAR[64]              | CHAR[64] | DATE      | DATE    | bool | bool   | CHAR[64] |



#### 硬件结构

x86-64单服务器

150Mbps上下行带宽Mbps

### 设计约束

#### 遵循标准

代码规范遵循[阿里巴巴开源代码规范]()

### 硬件约束

*   可用上行带宽150Mbps
*   可用下行带宽150Mbps
*   外存空间1T
*   内存32G
*   CPU16 core

## 其他约束

*   需要数据持久化方面的支持、，保存最近90日内写操作记录
*   不允许明文保存密码
*   有防止SQL注入攻击、DDOS的能力
*   有完善的日志系统
*   要求所有参数均可以通过配置文件修改
*   允许数据迁移

### 其他

*   商业原则
    *   高性价比
    *   受控的信息管理
    *   事物持续性
    *   兼容其他软件和操作系统
    *   知识产权保护
    *   7x24运维支持
    *   符合相关法律
*   数据原则
    *   数据资产保护
    *   数据共享保护
    *   受控数据访问
    *   可靠数据托管
    *   容易理解的数据定义和词汇
    *   数据安全性保证
*   应用程序原则
    *   技术无关
    *   易用
*   技术原则
    *   容许一定限度内的需求变化
    *   快速响应变更管理
    *   互操作性强
    *   控制技术多样
*   遵循关注点分离原则
*   遵循单一职责原则
*   遵循LoD原则

## 软件总体结构

### 分解视图

#### 分解说明



![SoftwareManual/useCase.jpg](E:/Repos/LeaderMeiSaveTheWorld/doc/SoftwareManual/useCase.jpg)

![SoftwareManual/class.jpg](E:/Repos/LeaderMeiSaveTheWorld/doc/SoftwareManual/class.jpg)

#### 各实体说明

见 [类和实体文档](./class.md)

#### 初始化 / 配置说明

 见[部署文档](./deploy.md)

### 运行视图

见上图

### 开发视图

见上图

## 接口说明

### 用户接口

见[接口文档](./interface.md)

### 外部接口

见[接口文档](./interface.md)

## 各功能实体与处理流程说明

### 数据结构

见[数据结构文档](./dataStructure.md)

### 各功能实体以及处理流程说明

#### 功能实体1

<!-- 功能1的处理流程说明，可以使用流程图、UML等方法进行描述。
说明如何实现这些功能，每个步骤是怎样实现的。
可根据功能再进行细分子实体进行描述。

这里有一点需要说明的是：如果本功能实体不再进行进一步分解的总体设计，那么这里必须描述本功能实体对外提供的接口，格式同4.2节 -->

### 功能实体2

## 出错处理设计

### 出错信息

[见StatusCode文档](./statusCode.md)

### 出错处理设计

*   利用状态码的设计，将所有的状态信息通过状态码处理。
*   每日停止服务后，自动执行备份。
*   所有的状态当日清空记入日志减小系统运行开销也防止系统频繁读取文本文件，减小出错几率。

### 系统维护设计

*   每日停止服务后，系统将自动执行当日的数据归档维护工作
*   待自动维护完成后，管理员可以对历史数据（日志文件）进行增量式备份
*   若要迁移数据，只需重新设置数据库位置即可运行，若需要迁移日志也可一并迁移
*   建议使用raid磁盘阵列储存数据库和日志以减轻硬盘故障带来的损害
*   建议使用windows的还原点功能进行备份

## 开发环境说明

*   本项目依托于windows平台
*   本项目基于java构建，兼容java11，12（其他版本尚未测试）
*   本项目由maven进行包管理
*   本项目的版本控制由git管理，使用github作为远程git服务端。

## 其他

*   暂无

# 用例描述



## 程序加载

*   用例描述
    *   当客户端程序被打开的时的自动操作
*   参与者
    *   客户端、服务端
*   前置条件
    *   程序完全加载
*   后置条件
    *   从服务端获取当日教室租借信息
    *   返回值```statusCode```为0
*   基本路径
    1.  向服务器发起教室租借占用情况请求
    2.  服务器返回占用情况
    3.  客户端根据返回信息进行绘制
    4.  客户端自动将自己的用户类型标识为```visitor```
*   扩展点
    *   3a 返回值```statusCode```为0x0001至0x0003
        *   使用模态对话框提示对应消息信息
        *   重新开始加载（尝试5次）
*   补充说明
    *   无

## 用户登录

*   用例描述

    *   用户进行登录活动

*   参与者

    *   用户、客户端、服务端

*   前置条件

    *   用户名框和密码框正确填写

*   后置条件

    *   客户端获得的```statusCode```为0且获得一个session对象
    *   返回值```statusCode```为0

*   基本路径

    1.  用户主动点击登录按钮或者用户在```visitor```身份下尝试进行预约操作（点击timeline）
    2.  服务器返回```session```和```statusCode```
    3.  客户端将返回的```session```暂存在本地
    4.  客户端更新相应ui组件

*   扩展点

    *   2a 返回值```statusCode```为x0010

        *   使用模态消息框提示

            >   账户或密码错误

    *   2b 返回值```statusCode```为0x0011至0x0012

        *   使用模态消息框提示对应消息

    *   2c 返回值```statusCode```为0x0001至0x0003

        *   使用模态对话框提示对应消息信息
        *   重新开始加载（尝试5次），失败或被用户取消则

## 用户预约

*   用例描述
    *   用户点击timeline空白处新建一个教室预约信息
*   参与者
    *   用户、客户端、服务端
*   前置条件
    *   程序已加载
*   后置条件
    *   成功预约教室
    *   服务器返回statusCode为0
    *   产生新的session
*   基本路径
    1.  用户点击timeline空白区域
    2.  检测用户拥有一个session
    3.  检测用户类型为user或者administrator
    4.  调起预约窗口
    5.  用户填写预约起止时间
    6.  客户端生成请求预约对象发送给服务器
    7.  服务器返回应答预约对象
    8.  客户端调用模态对话框提示预约完成
*   扩展点
    *   2a 客户端session为None
        *   调起**用户登录**模块登录
        *   继续步骤2
    *   3a 客户端用户类型为visitor
        *   调起**用户登录**模块登录
        *   继续步骤2
    *   7a 返回值```statusCode```为0x0012
        *   使用模态消息框提示相应信息
        *   调起**用户登录**模块登录
        *   继续步骤2
    *   7b 返回值```statusCode```为0x0001至0x0003
        *   使用模态消息框提示相应信息
        *   重新开始加载（尝试5次），失败或用户选择取消则停止撤销此次操作。

## 教室占用信息更新

*   用例描述

    *   用户手动或计时器触发更新timeline

*   参与者

    *   [用户]、客户端、服务端

    *   前置条件

        *   程序已加载
        *   session不为None

    *   后置条件

        *   服务器返回教室占用信息
        *   服务器返回的```statusCode```为0x0000

    *   基本路径

        1.  事件触发
        2.  向服务器发送请求占用信息请求
        3.  服务器发送占用信息列表和```statusCode```
        4.  更新ui系统

    *   扩展点

        *   3a 服务器返回值 ```statusCode```为0x0001至0x0003
            *   弹出模态对话框提示对应信息
            *   重新开始加载（一直尝试）
        *   3b 客户端用户类型为visitor
            *   调起**用户登录**模块登录
            *   继续步骤2
        *   3c 返回值```statusCode```为0x0012
            *   使用模态消息框提示相应信息
            *   调起**用户登录**模块登录
            *   继续步骤2

        *   3d 返回值```statusCode```为0x0001至0x0003
            *   使用模态消息框提示相应信息
            *   重新开始加载（尝试5次），失败或用户选择取消则停止撤销此次操作。

# 类和实体说明

*   Role
    *   用户角色的抽象类，用来描述用户的共有属性和操作
        *   用户角色有uuid、name、session属性分别对应用户唯一标识号、昵称和会话id信息
    *   Administrator
        *   管理员账号，拥有按人查询和按房间查询详情（所有订单信息）的权限、拥有对所有订单的增删操作
    *   User
        *   学生和教师账号，拥有按人（仅限自己）和房间查询占用（是否占用）的权限，拥有对自己的订单的增删操作
    *   Visitor
        *   访客账号，拥有房间查询占用（是否占用）的权限
*   InfoList
    *   封装的订单列表，拥有一个订单数组和数组长度信息
*   Order
    *   订单信息，包含以下属性
        *   classRoom教室对象
        *   user用户对象
        *   startTime开始租借时间
        *   endTime结束租借时间
        *   used是否被使用
        *   breach是否违约
        *   remarks备用信息字段
*   Session
    *   表示活动会话
        *   sessionID:每次成功登陆后下发的会话标识码
*   ClassRoom
    *   教室标识符
        *   name:标识符
*   RequestMessage
    *   （从用户视角而言）发送订单信息，通过接口发送一个该对象即可
        *   数据成员
            *   role:用户角色，表示请求提供方身份标识信息
            *   order:订单信息，表示请求方请求的订单
        *   成员函数
            *   post:调用发送接口，订单信息构造完成后，调用此函数即可提交订单
                *   返回值:statusCode，状态码，用于指示请求结果
*   AcknowledgeMessage
    *   （从用户视角而言）返回订单信息，通过接口发送一个对象
        *   数据成员
            *   RequestMessage中所有数据成员
            *   statusCode添加一个statusCode一并返回
*   StatusCode
    *   状态码，指示操作返回情况，详见[statusCode](./statusCode.md)
*   UserInfo
    *   服务端在客户机上储存的信息结构
    *   类成员
        *   inputUserName输入的用户名
        *   inputUserPassword输入的用户密码的哈希
    *   成员函数
        *   login用户登陆时触发函数，若成功登录则储存session信息
        *   logout清除用户名用户密码和session信息，退出登录

### 接口（3个）

*   post
    *   相关方：网络、客户端
    *   功能：将客户端预约教室的请求发送到服务端
    *   调用位置：RequestMessage类下的成员函数post()
    *   使用方法：
        1.  客户端填写生成一个新的requestMessage对象并填写role和order信息
        2.  执行post()函数
    *   返回值：StatusCode，客户端由返回值类型显示“预约成功”或者报错
*   get
    *   相关方：网络、服务端
    *   功能：接受客户端由post()发出的请求、提取出请求信息并查询预约，将结果以StatusCode的形式返回给客户端并记录到日志
    *   调用位置：AcknowledgeMessage类下的成员函数get()
    *   使用方法：
        1.  服务端生成一个新的AcknowledgeMessage对象并调用get()成员函数
        2.  get成员函数会生成一个线程进行阻塞式等待
        3.  当捕获到来自客户端的请求后，将requestMessage对象的信息拷贝到自己的成员中，调用数据库接口并得到StatusCode，返回给客户端，填写本对象的statusCode值
    *   返回值：本对象，用于日志记录
*   login
    *   相关方：网络、客户端
    *   功能：用户登录
    *   调用位置：UserInfo类下的成员函数login()
    *   使用方法：
        1.  客户端生成一个新的UserInfo对象并填写用户名和密码的哈希值
        2.  执行login()函数
    *   返回值：Session和StatusCode元组，获得返回值后，根据StatusCode执行操作并保存Session，在重新登陆之前，使用此Session来发送请求
*   acceptLogin
    *   相关方：网络、服务端
    *   功能：服务端接受用户登录
    *   调用位置：ServerUserInfo类下的成员函数acceptLogin()
    *   使用方法：
        1.  服务端生成一个新的ServerUserInfo对象并调用acceptLogin()成员函数
        2.  acceptLogin成员函数会生成一个线程进行阻塞式等待
        3.  当捕获到来自客户端的请求后，将UserInfo对象的信息拷贝到自己的成员中，调用数据库接口并得到StatusCode，若通过验证，生成Session信息，将StatusCode和Sessioni信息下发给客户端。
    *   返回值：本对象，用于挂到会话队列中等待下次申请
*   logout
    *   相关方：客户端
    *   功能：服务端退出登录
    *   调用位置：UserInfo类下的logout()函数
    *   使用方法：
        1.  用户点击退出登录或者接收到超时StatusCode时，触发此函数
        2.  清除客户端的UserInfo信息（全部置为None）
    *   返回值：无（不通知服务器）
*   update
    *   相关方：客户端、服务端
    *   功能：定期从服务端拉取教室占用信息并更新到ui系统上
    *   调用位置：
        *   ClassInfo类下的成员函数update()
    *   使用方法：
        *   客户端生成一个ClassInfo对象、填充session并挂载到一个定期触发的线程中
        *   update方法返回一个infoList和statusCode
        *   根据infoList信息绘制占用ui
    *   返回值：infoList和statusCode

# Status Code

>   返回值状态码，定义以本文件为准

## Status Code

*   0x0000
    *   操作成功（无异常）
*   0x0001
    *   网络失败（网络连接异常）[附录0000](#0000)
*   0x0002
    *   找不到服务器（网络连接正常但是服务器无法访问）[附录0000](#0000)
*   0x0003
    *   服务不可用（服务器能ping通但是网络接口不响应）
*   0x0004-0x000f
    *   预留
*   0x0010
    *   登陆失败：账号密码填写错误
*   0x0011
    *   登录超时：会话连接已超时
*   0x0012
    *   账号异常：账号信息异常，请重新登录[附录0003](#0003)
*   0x0013
    *   要求登录：请登录[附录0001](#0001)
*   0x0014
    *   权限不足：权限不足[附录0002](#0002)
*   0x0015
    *   操作失败：预约冲突，房间已经被预约
*   0x0016
    *   操作失败：预约失败，请求预约的信息不合法
*   0x0017
    *   操作失败，频繁登录
*   0x0018-0x001f
    *   预留
*   0x0020
    *   服务不可用：服务器正在维护，暂停提供预约服务
*   0x0021
    *   不在服务时间内：不在服务时间内，不提供预约服务

## Appendix

### 0000

关于返回```0x0001```和```0x0002```的区别：当发现连接错误时，请先尝试ping一下网址：

*   https://www.baidu.com
*   https://www.bing.com
*   https://www.google.com

ping设置，每个网址ping 4次，超时5000ms，如果至少有一次成功，应当返回```0x0002```，否则返回```0x0001```

### 0001

当前仅当用户为visitor并且尝试预约时，返回该状态码，此时服务端应该提示需要登陆并打开登陆界面

### 0002

发现提交的操作不符合账户权限，防止用户使用非正常操作方式（比如爬虫等）使用当前用户尝试操作当前等级不允许操作的操作，则返回此状态码

### 0003

发现会话信息和用户信息不匹配，防止用户使用非正常操作方式（比如爬虫等），构造不合法的身份信息

# ATAM评估表

*   敏感点

    *   ui设计
    *   ux逻辑
    *   database基准性能
    *   网络连接基准性能
    *   并发访问性能
    *   平均响应时间
    *   登录便利性
    *   

*   权衡点

    *   加密方法与响应时间
    *   内存与CPU占用和并发线程数

*   Stakeholders

    *   体系结构设计师
    *   开发人员
    *   运维人员
    *   集成人员
    *   测试人员

*   场景

    *   0000 用户登录

        *   刺激源：用户\客户端事件系统
        *   刺激：登录
        *   环境：客户端、服务端
        *   反应：执行登录操作过程
        *   响应度量：平均响应时间

    *   0001 用户登出

        *   刺激源：用户\客户端事件系统
        *   刺激：登出
        *   环境：客户端
        *   反应：清除客户端session信息
        *   响应度量：平均响应时间

    *   0010 教室信息更新

        *   刺激源：客户端事件系统
        *   刺激：教室信息更新事件触发
        *   环境：客户端、服务端
        *   反应：执行更新信息过程
        *   响应度量：平均响应时间

    *   0020 用户请求订单

        *   刺激源：用户
        *   刺激：用户填写订单
        *   环境：客户端\服务端
        *   反应：执行订单请求过程
        *   响应度量：平均响应时间

        

# 评估测试表

*   基本信息表

    | 测试项目        | 测试模块      | 开发者    | 测试人 | 评估阶段 | 测试日期   |
    | --------------- | ------------- | --------- | ------ | -------- | ---------- |
    | Example program | Example model | Develop A | Test A | 前/后期  | 2019/04/05 |

    

*   质量属性评估（子项内均分大项分数，有勾加分无勾不加分）

    *   可修改性(x(填写分数)/20’)
        *   [ ] 高内聚
        *   [ ] 低耦合
        *   [ ] 依赖倒置
        *   [ ] 接口实现分离
        *   [ ] 代码风格和注释
    *   可用性(/10’)
        *   [ ] ```>98%```
        *   [ ] ```>99%```
        *   [ ] ```>99.5%```
        *   [ ] ```>99.9%```
        *   [ ] ```>99.99%```
    *   性能(/20’)
        *   [ ] 按照指标评定
    *   可测试性(/10’)
        *   [ ] 良好的测试接口
        *   [ ] 逻辑结构简单
        *   [ ] 低圈复杂度
        *   [ ] 结构清晰
    *   易用性(/10’)
        *   [ ] 主观评定
    *   安全性(/20’)
        *   [ ] 防SQL注入( 若无，此项不计)
        *   [ ] session验证
        *   [ ] 明文密码
        *   [ ] 越权执行
        *   [ ] DDos攻击
        *   [ ] 非法数据流攻击
    *   其他(/10’)
        *   [ ] 自行填写

*   总评(/100’)

# 安装和配置

服务端配置在windows10 Enterprise版本上，build不低于10240。

## 前期准备

*   部署MySQL数据库，迁移用户数据
*   安装应用程序，运行
*   分配端口号，注册DNS（若需要）

## 维护

### 常规维护

*   每日00:00后，系统暂停服务,00 :05~01:00之间执行数据维护（将当日Session信息写入历史记录）
*   若有非紧急情况的人工维护，比如升级和迁移设备等，请在01:00之后操作即可，操作完成后直接重启即可

### 紧急维护

*   对于紧急情况而言，请尽量先将该日预约信息保存，再进行操作

## 人员分工表

*   评估 **梅洛瑜** 71117408
    *   负责code review
    *   负责对修改意见进行整理并汇合与架构协商
    *   负责评估模块的各项质量是否符合指标
    *   负责功能性测试（测试）
    *   负责硬件维护（运维）
*   网络 **张景天** 71117435
    *   负责网络模块的实现与封装
        *   实现模块:requestMessage,responseMessage
*   数据持久化 **刘钰宵** 71117405
    *   负责数据库模块的实现和封装
    *   负责日志系统的实现和封装
    *   负责权限审核模块的实现和封装（暂未构建）
*   客户端 **丁玟月** 71117401
    *   负责客户端交互逻辑和对应模块的实现和封装
*   服务端 **张婧媛** 71117402
    *   负责服务端业务逻辑的实现和封装
*   架构 **卢立强** 71117417
    *   负责架构文档的撰写和维护
    *   负责人员之间的需求协调和沟通
    *   负责code review